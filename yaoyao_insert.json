{"comment":"sticker_all","sql":"SELECT concat(substr(try_cast(table1.cdate AS VARCHAR),1,4),'-',substr(try_cast(table1.cdate AS VARCHAR),5,2),'-',substr(try_cast(table1.cdate AS VARCHAR),7,2)) AS cdate,table1.app_key,case table1.app_key when 'e2934742f9d3b8ef2b59806a041ab389' then'ikey' when'78472ddd7528bcacc15725a16aeec190' then'kika' when'4e5ab3a6d2140457e0423a28a094b1fd' then 'pro'end as product,table1.emoji_pv,table1.emoji_uv,table2.show_pv,table2.show_uv,table1.emoji_pv+table2.show_pv AS total_pv,table3.send_pv,table3.send_uv,table3.send_pv/(1.0*(table1.emoji_pv+table2.show_pv))AS CTR,table4.store_entrance_pv,table4.store_entrance_uv,table5.add_sticker_pv,table5.add_sticker_uv FROM(SELECT cdate,app_key,COUNT(deviceuid)AS emoji_pv,COUNT(DISTINCT deviceuid)AS emoji_uv FROM event WHERE layout='keyboard_sticker2'AND item='container'AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND app_key in('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')AND event_part='keyboard' GROUP BY cdate,app_key) table1 JOIN (SELECT cdate, app_key, COUNT(deviceuid) AS show_pv, COUNT(DISTINCT deviceuid) AS show_uv FROM event WHERE layout = 'keyboard_sticker2_content'  AND event_part = 'keyboard'  AND item = 'content'  AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND app_key in ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')  GROUP BY cdate,app_key) table2 ON table1.cdate=table2.cdate AND table1.app_key=table2.app_key JOIN (SELECT cdate,app_key,COUNT(deviceuid) AS send_pv,COUNT(DISTINCT deviceuid) AS send_uv FROM event WHERE layout='keyboard_sticker2_content' AND event_part='keyboard' AND item='send' AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer)AND app_key in('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')GROUP BY cdate,app_key)table3 ON table1.cdate=table3.cdate AND table1.app_key=table3.app_key JOIN(SELECT cdate,app_key,COUNT(deviceuid)AS store_entrance_pv,COUNT(DISTINCT deviceuid)AS store_entrance_uv FROM event WHERE layout='keyboard_sticker2_container'AND item='click_store'AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer)AND app_key in('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')AND event_part='keyboard'GROUP BY cdate,app_key)table4 ON table1.cdate=table4.cdate AND table1.app_key=table4.app_key JOIN(SELECT cdate,app_key,COUNT(deviceuid)AS add_sticker_pv,COUNT(DISTINCT deviceuid)AS add_sticker_uv FROM event WHERE layout IN('sticker2_store_trending','sticker2_store_all','sticker2_detail')AND item='add'AND event_part='other'AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer)AND app_key in('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')GROUP BY cdate,app_key)table5 ON table1.cdate=table5.cdate AND table1.app_key=table5.app_key ORDER BY cdate,app_key","spreadsheetId":"1V4G_31oeAHZf0m_vxNGLdDXmdsa9GZ_qweuGVBbu0oA","rangeName":"sticker_all!A1:Z"}
{"comment":"ctr_language","sql":"SELECT concat(substr(try_cast(a.cdate AS VARCHAR),1,4),'-',substr(try_cast(a.cdate AS VARCHAR),5,2),'-',substr(try_cast(a.cdate AS VARCHAR),7,2)) AS cdate,a.app_key,case a.app_key when 'e2934742f9d3b8ef2b59806a041ab389' then 'ikey' when'78472ddd7528bcacc15725a16aeec190' then'kika' when'4e5ab3a6d2140457e0423a28a094b1fd' then 'pro' end as product,b.DAU,a.lang,a.v_show_pv,a.v_send_pv,a.CTR,a.v_show_uv ,a.v_show_uv / (1.0 * b.DAU),a.v_send_uv,a.v_send_uv / (1.0 * b.DAU), a.uv_CTR,a.send_person,a.show_person, a.send_show_person,a.instant_show_pv ,a.instant_send_pv ,a.instant_CTR,a.instant_show_uv ,a.instant_send_uv,a.instant_uv_CTR, a.context_show_pv ,a.context_send_pv ,a.context_CTR,a.context_show_uv ,a.context_send_uv,a.context_uv_CTR FROM(SELECT cdate ,app_key ,lang, v_show_pv , v_send_pv ,v_send_pv/(1.0 * v_show_pv) AS CTR, v_show_uv ,v_send_uv,v_send_uv/(1.0 * v_show_uv) AS uv_CTR,v_send_pv / (1.0 * v_send_uv) AS send_person,v_send_pv / (1.0 * v_show_uv) AS show_person, v_send_pv/ (1.0*v_show_uv) AS send_show_person,instant_show_pv ,instant_send_pv ,instant_send_pv/(1.0 * instant_show_pv) AS instant_CTR,instant_show_uv ,instant_send_uv,instant_send_uv / (1.0 * instant_show_uv) AS instant_uv_CTR,context_show_pv,context_send_pv,context_send_pv / (1.0 * context_show_pv) AS context_CTR,context_show_uv ,context_send_uv,context_send_uv / (1.0 * context_show_uv) AS context_uv_CTR FROM (SELECT a.cdate,a.app_key,a.lang,SUM(show_pv) AS v_show_pv ,SUM(send_pv) AS v_send_pv ,COUNT (distinct a.deviceuid) AS v_show_uv ,COUNT (distinct b.deviceuid) AS v_send_uv,SUM(case WHEN a.source = 'recommend_after_send' THEN  show_pv end) AS context_show_pv,SUM(case WHEN b.source = 'recommend_after_send' THEN send_pv end) AS context_send_pv,COUNT (distinct CASE WHEN a.source = 'recommend_after_send' THEN a.deviceuid end) AS context_show_uv,COUNT (distinct CASE WHEN b.source = 'recommend_after_send' THEN b.deviceuid end) AS context_send_uv,  SUM(case WHEN a.source = 'recommend' THEN show_pv end) AS instant_show_pv ,  SUM(case  WHEN b.source = 'recommend' THEN send_pv end) AS instant_send_pv ,COUNT (distinct CASE WHEN a.source = 'recommend' THEN a.deviceuid end) AS instant_show_uv ,  COUNT (distinct CASE WHEN b.source = 'recommend' THEN b.deviceuid end) AS instant_send_uv FROM  (SELECT COUNT(deviceuid) AS show_pv,deviceuid ,substr(lang,1,2) AS lang, COUNT(distinct deviceuid) AS show_uv , json_extract_scalar(extra, '$.sticker_id') AS sticker_id , json_extract_scalar(extra, '$.tag') AS tag , json_extract_scalar(extra, '$.source') AS source, cdate,app_key FROM event WHERE layout = 'sticker2_suggestion' AND item = 'pop' AND app_key in ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')  AND cdate = cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND event_part='other' GROUP BY  deviceuid ,substr(lang,1,2) , json_extract_scalar(extra, '$.sticker_id') , json_extract_scalar(extra, '$.tag') , cdate , json_extract_scalar(extra, '$.source') ,app_key )a LEFT JOIN ( SELECT COUNT(deviceuid) AS send_pv , COUNT(distinct deviceuid) AS send_uv , deviceuid,substr(lang,1,2) AS lang, json_extract_scalar(extra,'$.item_id') AS item_id,json_extract_scalar(extra, '$.key_word') AS key_word,json_extract_scalar(extra, '$.source') AS source, cdate,app_key FROM event WHERE layout = 'keyboard_sticker2_suggestion_pop' AND item = 'send' AND app_key in ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd') AND cdate = cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND event_part='keyboard' GROUP BY  deviceuid ,substr(lang,1,2),json_extract_scalar(extra, '$.source') , json_extract_scalar(extra, '$.item_id') , json_extract_scalar(extra, '$.key_word') , cdate ,app_key )b ON a.deviceuid = b.deviceuid AND a.cdate = b.cdate AND a.sticker_id = b.item_id AND a.tag = b.key_word AND a.lang = b.lang  AND a.app_key = b.app_key GROUP BY  a.app_key, a.cdate,a.lang ORDER BY  a.cdate,a.app_key) where v_show_pv > 10000)a LEFT JOIN (SELECT cdate, app_key,substr(lang,1,2) AS lang,count(distinct deviceuid) AS DAU FROM service_merge_daily WHERE app_key in ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd') AND cdate = cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND iskeyboard=1  GROUP BY  cdate,app_key,substr(lang,1,2) ORDER BY cdate DESC )b ON a.cdate = b.cdate  AND a.app_key = b.app_key  AND a.lang = b.lang","spreadsheetId":"1V4G_31oeAHZf0m_vxNGLdDXmdsa9GZ_qweuGVBbu0oA","rangeName":"整体CTR分语言!A1:AC"}
{"comment":"popup_new_all","sql":"SELECT concat(substr(try_cast(a.cdate AS VARCHAR),1,4),'-',substr(try_cast(a.cdate AS VARCHAR),5,2),'-',substr(try_cast(a.cdate AS VARCHAR),7,2)) AS cdate,a.app_key ,case a.app_key when 'e2934742f9d3b8ef2b59806a041ab389' then 'ikey' when'78472ddd7528bcacc15725a16aeec190' then'kika' when'4e5ab3a6d2140457e0423a28a094b1fd' then'pro' end as product,c.word_count,a.v_show_pv,a.v_send_pv, a.v_send_pv/(1.0 * v_show_pv) AS CTR,a.v_show_uv ,a.v_send_uv,a.v_send_uv/(1.0 * v_show_uv) AS uv_CTR,a.v_send_pv/(1.0 * v_send_uv) AS send_person,b.send_pv_mid,a.v_show_pv/(1.0 * v_show_uv) AS show_avg_person,b.show_pv_mid,a.v_send_pv/(1.0 * v_show_uv)AS show_person,a.v_send_pv / (1.0 * v_show_uv) AS send_show_person,a.instant_show_pv ,a.instant_send_pv,a.instant_send_pv / (1.0 * instant_show_pv) AS instant_CTR,a.instant_show_uv ,a.instant_send_uv,a.instant_send_uv / (1.0 * instant_show_uv) AS instant_uv_CTR,a.context_show_pv ,a.context_send_pv,a.context_send_pv / (1.0 * context_show_pv) AS context_CTR,a.context_show_uv,a.context_send_uv, a.context_send_uv / (1.0 * context_show_uv) AS context_uv_CTR FROM (SELECT a.cdate,a.app_key,SUM(show_pv) AS v_show_pv,SUM(send_pv) AS v_send_pv,COUNT (distinct a.deviceuid) AS v_show_uv,COUNT (distinct b.deviceuid) AS v_send_uv,SUM(case WHEN a.source = 'recommend_after_send' THEN show_pv end) AS context_show_pv,SUM(case WHEN b.source = 'recommend_after_send' THEN send_pv end) AS context_send_pv,COUNT (distinct CASE WHEN a.source = 'recommend_after_send' THEN a.deviceuid end) AS context_show_uv,COUNT (distinct CASE WHEN b.source = 'recommend_after_send' THEN b.deviceuid end) AS context_send_uv,SUM(case WHEN a.source = 'recommend' THEN show_pv end) AS instant_show_pv,SUM(case WHEN b.source = 'recommend' THEN send_pv end) AS instant_send_pv,COUNT (distinct CASE WHEN a.source = 'recommend' THEN a.deviceuid end) AS instant_show_uv,COUNT (distinct CASE WHEN b.source = 'recommend' THEN b.deviceuid end) AS instant_send_uv FROM (SELECT COUNT(deviceuid) AS show_pv,deviceuid, COUNT(distinct deviceuid) AS show_uv, json_extract_scalar(extra, '$.sticker_id') AS sticker_id,json_extract_scalar(extra, '$.tag') AS tag,json_extract_scalar(extra, '$.source') AS source, cdate,app_key FROM event WHERE layout = 'sticker2_suggestion' AND item = 'pop' AND app_key in ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd') AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND event_part='other' GROUP BY  deviceuid , json_extract_scalar(extra, '$.sticker_id') , json_extract_scalar(extra, '$.tag'), cdate,json_extract_scalar(extra, '$.source') ,app_key )a LEFT JOIN (SELECT COUNT(deviceuid) AS send_pv,COUNT(distinct deviceuid) AS send_uv,deviceuid,json_extract_scalar(extra,'$.item_id') AS item_id,json_extract_scalar(extra, '$.key_word') AS key_word,json_extract_scalar(extra, '$.source') AS source, cdate,app_key FROM event WHERE layout = 'keyboard_sticker2_suggestion_pop' AND item = 'send' AND app_key in ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')  AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND event_part='keyboard' GROUP BY  deviceuid ,json_extract_scalar(extra, '$.source') , json_extract_scalar(extra, '$.item_id') , json_extract_scalar(extra, '$.key_word'),cdate ,app_key)b ON a.deviceuid = b.deviceuid AND a.cdate = b.cdate AND a.sticker_id = b.item_id AND a.tag = b.key_word AND a.app_key = b.app_key GROUP BY  a.app_key, a.cdate ORDER BY  a.cdate, a.app_key)a JOIN (SELECT cdate, app_key,approx_percentile(show_pv,0.5) AS show_pv_mid,approx_percentile(send_pv,0.5) AS send_pv_mid FROM(SELECT  COUNT(case WHEN layout = 'sticker2_suggestion' and item = 'pop' and event_part='other' THEN deviceuid END) AS show_pv, COUNT(case WHEN layout = 'keyboard_sticker2_suggestion_pop' and item = 'send' and event_part='keyboard' THEN deviceuid END) AS send_pv,deviceuid,cdate,app_key FROM event WHERE (layout = 'sticker2_suggestion' or layout = 'keyboard_sticker2_suggestion_pop')AND (item = 'pop' or item = 'send') AND app_key in ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')  AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND (event_part='other' or event_part='keyboard')GROUP BY cdate,deviceuid,app_key)GROUP BY cdate,app_key ORDER BY app_key,cdate)b ON a.cdate = b.cdate and a.app_key = b.app_key JOIN (SELECT cdate,app_key,SUM(word_count) AS word_count FROM (SELECT cdate,app_key,word_count FROM gimbal.word_trace_desensitization WHERE cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND app_key in ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd')) GROUP BY cdate,app_key)c ON a.cdate = c.cdate and a.app_key = c.app_key","spreadsheetId":"1V4G_31oeAHZf0m_vxNGLdDXmdsa9GZ_qweuGVBbu0oA","rangeName":"popup_new_all!A1:AC"}
{"comment":"ctr_nation","sql":"SELECT concat(substr(try_cast(a.cdate AS VARCHAR), 1, 4), '-',substr(try_cast(a.cdate AS VARCHAR),5,2),'-',substr(try_cast(a.cdate AS VARCHAR),7,2)) AS cdate,a.app_key,case a.app_key  WHEN 'e2934742f9d3b8ef2b59806a041ab389' THEN  'ikey' when'78472ddd7528bcacc15725a16aeec190' then'kika' when'4e5ab3a6d2140457e0423a28a094b1fd' THEN  'pro'  END AS product,b.DAU, a.lang, a.v_show_pv, a.v_send_pv, a.CTR, a.v_show_uv , a.v_show_uv / (1.0 * b.DAU), a.v_send_uv, a.v_send_uv / (1.0 * b.DAU),  a.uv_CTR, a.send_person, a.show_person,  a.send_show_person, a.instant_show_pv ,  a.instant_send_pv , a.instant_CTR, a.instant_show_uv ,a.instant_send_uv,a.instant_uv_CTR, a.context_show_pv ,a.context_send_pv ,a.context_CTR,a.context_show_uv ,a.context_send_uv,a.context_uv_CTR   FROM(SELECT cdate , app_key ,  lang, v_show_pv ,  v_send_pv , v_send_pv/(1.0 * v_show_pv) AS CTR,  v_show_uv , v_send_uv,  v_send_uv/(1.0 * v_show_uv) AS uv_CTR, v_send_pv / (1.0 * v_send_uv) AS send_person, v_send_pv / (1.0 * v_show_uv) AS show_person,  v_send_pv/ (1.0*v_show_uv) AS send_show_person,instant_show_pv , instant_send_pv ,instant_send_pv/(1.0 * instant_show_pv) AS instant_CTR, instant_show_uv ,instant_send_uv,instant_send_uv / (1.0 * instant_show_uv) AS instant_uv_CTR, context_show_pv, context_send_pv,context_send_pv / (1.0 * context_show_pv) AS context_CTR, context_show_uv , context_send_uv, context_send_uv / (1.0 * context_show_uv) AS context_uv_CTR FROM  (SELECT a.cdate, a.app_key,a.lang, SUM(show_pv) AS v_show_pv ,SUM(send_pv) AS v_send_pv ,COUNT (distinct a.deviceuid) AS v_show_uv , COUNT (distinct b.deviceuid) AS v_send_uv, SUM(case WHEN a.source = 'recommend_after_send' THEN show_pv end) AS context_show_pv,SUM(case WHEN b.source = 'recommend_after_send' THEN send_pv end) AS context_send_pv,COUNT (distinct CASE  WHEN a.source = 'recommend_after_send' THEN a.deviceuid end) AS context_show_uv,COUNT (distinct CASE WHEN b.source = 'recommend_after_send' THEN b.deviceuid end) AS context_send_uv, SUM(case WHEN a.source = 'recommend' THEN show_pv end) AS instant_show_pv , SUM(case WHEN b.source = 'recommend' THEN send_pv end) AS instant_send_pv ,COUNT (distinct CASE WHEN a.source = 'recommend' THEN a.deviceuid end) AS instant_show_uv , COUNT (distinct CASE WHEN b.source = 'recommend' THEN b.deviceuid end) AS instant_send_uv FROM  (SELECT COUNT(deviceuid) AS show_pv, deviceuid ,substr(lang, 1, 2) AS lang, COUNT(distinct deviceuid) AS show_uv , json_extract_scalar(extra, '$.sticker_id') AS sticker_id , json_extract_scalar(extra, '$.tag') AS tag , json_extract_scalar(extra, '$.source') AS source, cdate,app_key FROM event WHERE layout in ('sticker2_suggestion','sticker2_fpopup') AND item in ('pop','pop_show')  AND app_key IN('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd') AND cdate = cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND event_part='other'  GROUP BY  deviceuid ,substr(lang,1,2) , json_extract_scalar(extra, '$.sticker_id') , json_extract_scalar(extra, '$.tag') , cdate , json_extract_scalar(extra, '$.source') ,app_key )a LEFT JOIN  (SELECT COUNT(deviceuid) AS send_pv , COUNT(distinct deviceuid) AS send_uv , deviceuid, substr(lang, 1, 2) AS lang, json_extract_scalar(extra, '$.item_id') AS item_id,json_extract_scalar(extra, '$.key_word') AS key_word,json_extract_scalar(extra, '$.source') AS source, cdate,app_key FROM event WHERE layout in ('keyboard_sticker2_suggestion_pop','sticker2_fpopup') AND item = 'send' AND app_key IN ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd') AND cdate = cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer)  AND event_part='keyboard' GROUP BY  deviceuid ,substr(lang,1,2),json_extract_scalar(extra, '$.source') , json_extract_scalar(extra, '$.item_id') , json_extract_scalar(extra, '$.key_word') , cdate ,app_key )b ON a.deviceuid = b.deviceuid AND a.cdate = b.cdate AND a.sticker_id = b.item_id  AND a.tag = b.key_word AND a.lang = b.lang  AND a.app_key = b.app_key GROUP BY  a.app_key, a.cdate,a.lang ORDER BY  a.cdate,a.app_key)  WHERE v_show_pv > 10000)a LEFT JOIN  (SELECT cdate, app_key,substr(lang,1,2) AS lang,count(distinct deviceuid) AS DAU FROM service_merge_daily WHERE app_key IN ('e2934742f9d3b8ef2b59806a041ab389','78472ddd7528bcacc15725a16aeec190','4e5ab3a6d2140457e0423a28a094b1fd') AND cdate = cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND iskeyboard=1 GROUP BY  cdate,app_key,substr(lang,1,2) ORDER BY  cdate DESC )b ON a.cdate = b.cdate AND a.app_key = b.app_key AND a.lang = b.lang","spreadsheetId":"1V4G_31oeAHZf0m_vxNGLdDXmdsa9GZ_qweuGVBbu0oA","rangeName":"整体CTR分nation!A1:AC"}
{"comment":"magictext","sql":"SELECT a.cdate,a.app_key,a.pop_uv+b.pop_uv,a.pop_pv+b.pop_pv,c.send_uv+d.send_uv,c.send_pv+d.send_pv,(c.send_pv+d.send_pv) / (1.0 * (a.pop_pv+b.pop_pv)) AS CT FROM( SELECT cdate,app_key,COUNT(distinct deviceuid) AS pop_uv,COUNT(deviceuid) AS pop_pv FROM event WHERE  cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer)  AND app_key  ='78472ddd7528bcacc15725a16aeec190' AND layout = 'sticker2_suggestion' AND item = 'pop' AND event_part = 'other'  AND json_extract_scalar(extra,'$.sticker_id') in  (SELECT sticker_id FROM( select sticker_id from(SELECT cdate,app_key,json_extract_scalar(extra,'$.item_id') AS sticker_id FROM event WHERE layout = 'keyboard_sticker2_suggestion_pop' AND item = 'send' AND cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer)   AND app_key in ('78472ddd7528bcacc15725a16aeec190') AND json_extract_scalar(extra,'$.pop_type') = 'magic') GROUP BY sticker_id,cdate,app_key))GROUP BY cdate,app_key)a LEFT JOIN ( select m.cdate as cdate ,m.app_key as app_key ,COUNT(distinct m.deviceuid) AS pop_uv,COUNT(m.deviceuid) AS pop_pv from(SELECT cdate,app_key,deviceuid,json_extract_scalar(extra,'$.recommend_pop_1') as extra_1,json_extract_scalar(extra,'$.recommend_pop_2') as extra_2 FROM event WHERE cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer)  AND app_key ='78472ddd7528bcacc15725a16aeec190' AND layout = 'sticker2_fpopup' AND item = 'pop_show')m where regexp_like(m.extra_1 ,'pop_type=magic') or regexp_like(m.extra_2 ,'pop_type=magic') group by m.cdate,m.app_key)b ON a.cdate =b.cdate AND a.app_key =b.app_key LEFT JOIN( SELECT cdate,app_key,COUNT(distinct deviceuid) AS send_uv,COUNT(deviceuid) AS send_pv FROM event WHERE cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer) AND app_key  ='78472ddd7528bcacc15725a16aeec190'  AND layout = 'keyboard_sticker2_suggestion_pop' AND item = 'send' AND event_part = 'keyboard' AND json_extract_scalar(extra,'$.type') = 'magic' GROUP BY cdate,app_key)c ON a.cdate =c.cdate AND a.app_key =c.app_key LEFT JOIN ( select m.cdate as cdate ,m.app_key as app_key ,COUNT(distinct m.deviceuid) AS send_uv,COUNT(m.deviceuid) AS send_pv from( SELECT cdate,app_key,deviceuid,json_extract_scalar(extra,'$.recommend_pop_1') as extra FROM event WHERE cdate=cast(concat(substr(cast((current_date-interval'2'day)as varchar),1,4),substr(cast((current_date-interval'2'day)as varchar),6,2),substr(cast((current_date-interval'2'day)as varchar),9,2))as integer)  AND app_key ='78472ddd7528bcacc15725a16aeec190' AND layout = 'sticker2_fpopup' AND item = 'send')m where regexp_like(m.extra ,'pop_type=magic') group by m.cdate,m.app_key)d on a.cdate=d.cdate and a.app_key=d.app_key","spreadsheetId":"1jk5JYU027NWUOc6n4jL9tYPoqg0t--IfH2jTxOqsTo0","rangeName":"整体!A:G"}